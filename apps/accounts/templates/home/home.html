{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard - Cafeteria Premium{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 to-gray-100">

    <!-- Main Content com layout mais fluido -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Sidebar moderna -->
            <div class="lg:col-span-3 space-y-6">
                
                <!-- Quick Actions com visual glassmorphism -->
                <div class="bg-white/70 backdrop-blur-md border border-white/20 rounded-3xl shadow-xl p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-8 h-8 bg-gradient-to-r from-violet-500 to-purple-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h2 class="text-lg font-semibold text-gray-900">Ações Rápidas</h2>
                    </div>
                    
                    <div class="space-y-3">
                        <!-- Nova Comanda com hover moderno -->
                        <button onclick="openOrderModal()" class="w-full group bg-gradient-to-r from-orange-500 to-pink-500 text-white px-6 py-4 rounded-2xl font-semibold hover:from-orange-600 hover:to-pink-600 transition-all duration-300 transform hover:scale-105 hover:shadow-lg shadow-md">
                            <div class="flex items-center justify-center space-x-3">
                                <svg class="w-5 h-5 group-hover:rotate-90 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span>Nova Comanda</span>
                            </div>
                        </button>
                        
                        <button class="w-full group bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-6 py-4 rounded-2xl font-semibold hover:from-emerald-600 hover:to-teal-600 transition-all duration-300 transform hover:scale-105 hover:shadow-lg">
                            <div class="flex items-center justify-center space-x-3">
                                <svg class="w-5 h-5 group-hover:rotate-12 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                                <span>Gerenciar Produtos</span>
                            </div>
                        </button>
                        
                        <button class="w-full group bg-gradient-to-r from-purple-500 to-indigo-500 text-white px-6 py-4 rounded-2xl font-semibold hover:from-purple-600 hover:to-indigo-600 transition-all duration-300 transform hover:scale-105 hover:shadow-lg">
                            <div class="flex items-center justify-center space-x-3">
                                <svg class="w-5 h-5 group-hover:scale-110 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4"></path>
                                </svg>
                                <span>Relatórios</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Status com animações -->
                <div class="bg-white/70 backdrop-blur-md border border-white/20 rounded-3xl shadow-xl p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-blue-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4"></path>
                            </svg>
                        </div>
                        <h2 class="text-lg font-semibold text-gray-900">Status Tempo Real</h2>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-orange-50 rounded-xl border border-orange-100">
                            <span class="text-gray-700 font-medium">Abertas</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></div>
                                <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-bold">8</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-xl border border-yellow-100">
                            <span class="text-gray-700 font-medium">Preparo</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></div>
                                <span class="bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-bold">5</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl border border-green-100">
                            <span class="text-gray-700 font-medium">Prontas</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">3</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-xl border border-blue-100">
                            <span class="text-gray-700 font-medium">Finalizadas Hoje</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                                <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-bold">22</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Grid modernizado -->
            <div class="lg:col-span-9">
                <div class="bg-white/70 backdrop-blur-md border border-white/20 rounded-3xl shadow-xl overflow-hidden">
                    
                    <!-- Header com tabs modernos e campo de pesquisa -->
                    <div class="p-6 border-b border-gray-100">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                                <div class="w-8 h-8 bg-gradient-to-r from-orange-500 to-pink-500 rounded-lg flex items-center justify-center mr-3">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                                Comandas do Balcão
                            </h2>
                            
                            <div class="flex items-center space-x-1 bg-gray-100 rounded-2xl p-1">
                                <button class="px-4 py-2 bg-white text-gray-900 rounded-xl text-sm font-medium shadow-sm">
                                    Todas
                                </button>
                                <button class="px-4 py-2 text-gray-600 hover:bg-white/50 rounded-xl text-sm font-medium transition-colors">
                                    Em Preparo
                                </button>
                                <button class="px-4 py-2 text-gray-600 hover:bg-white/50 rounded-xl text-sm font-medium transition-colors">
                                    Prontas
                                </button>
                            </div>
                        </div>

                        <!-- Campo de Pesquisa Moderno -->
                        <div class="relative max-w-md">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input 
                                type="text" 
                                id="search-comandas"
                                class="w-full pl-12 pr-12 py-3 bg-white/70 backdrop-blur-md border border-white/20 rounded-2xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-300 transition-all duration-300 shadow-sm hover:shadow-md" 
                                placeholder="Pesquisar por número da comanda, mesa ou cliente..."
                                autocomplete="off"
                            >
                            
                            <!-- Botão de limpar pesquisa -->
                            <button 
                                type="button"
                                id="clear-search"
                                class="absolute inset-y-0 right-0 pr-4 flex items-center opacity-0 transition-opacity duration-200 hover:text-gray-700"
                            >
                                <svg class="w-5 h-5 text-gray-400 hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                            
                            <!-- Contador de resultados -->
                            <div id="search-results" class="absolute top-full left-0 right-0 mt-2 text-sm text-gray-500 opacity-0 transition-opacity duration-200">
                                <span id="results-count">0</span> comandas encontradas
                            </div>
                        </div>
                    </div>

                    <!-- Grid de comandas com visual moderno -->
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                            
                            {% for comanda in comandas_abertas %}
                                <!-- Comanda real com estilo simplificado -->
                                <div onclick="openEditOrderModal('{{ comanda.code }}')" 
                                    style="height: 160px !important;"
                                    class="group relative bg-white border-2 cursor-pointer
                                    {% if comanda.status == 'aguardando' %}border-orange-100 hover:border-orange-300{% endif %}
                                    {% if comanda.status == 'preparando' %}border-yellow-100 hover:border-yellow-300{% endif %}
                                    {% if comanda.status == 'pronta' %}border-green-100 hover:border-green-300{% endif %}
                                    rounded-2xl p-3 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 "
                                    data-comanda 
                                    data-numero="{{ comanda.code }}" 
                                    data-mesa="{{ comanda.name }}">
                                
                                    <!-- Header da comanda -->
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="w-12 h-12 
                                                    {% if comanda.status == 'aguardando' %}bg-gradient-to-r from-orange-500 to-pink-500{% endif %}
                                                    {% if comanda.status == 'preparando' %}bg-gradient-to-r from-yellow-500 to-orange-500{% endif %}
                                                    {% if comanda.status == 'pronta' %}bg-gradient-to-r from-emerald-500 to-teal-500{% endif %}
                                                    rounded-2xl flex items-center justify-center text-white font-bold">
                                            #{{ comanda.id }}
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-900">{{ comanda.name }}</p>
                                            <p class="text-xs text-gray-500">
                                                {{ comanda.created_at|time:"H:i" }} • 
                                                {% if comanda.status == 'aguardando' %}Aguardando
                                                {% elif comanda.status == 'preparando' %}Em preparo
                                                {% elif comanda.status == 'pronta' %}Pronta
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <!-- Valor centralizado -->
                                    <div class="border-t border-gray-100 pt-2 mb-2">
                                        <div class="text-center">
                                            <span class="text-lg font-bold text-gray-900">R$ {{ comanda.total_amount }}</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Botão Detalhes -->
                                    <button onclick="event.stopPropagation(); openEditOrderModal('{{ comanda.code }}')" 
                                            class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white py-2 px-4 rounded-xl text-sm font-semibold hover:from-emerald-600 hover:to-teal-600 transition-all transform hover:scale-105">
                                        Detalhes
                                    </button>
                                </div>
                            {% empty %}
                                <!-- Quando não há comandas -->
                                <div class="col-span-full text-center py-12">
                                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhuma comanda aberta</h3>
                                    <p class="text-gray-500">Todas as comandas foram finalizadas ou não há comandas criadas.</p>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% include 'home/order_modal.html' %}
{% include 'home/detail_modal.html' %}
{% include 'home/payment_modal.html' %}

<script src="{% static 'js/utils.js' %}"></script>

<script>
function openOrderModal() {
    const modal = document.getElementById('orderModal');
    if (modal) {
        // Remover classes que escondem
        modal.classList.remove('hidden', 'opacity-0');
        
        // Forçar propriedades do overlay
        modal.style.cssText = `
            display: flex !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 9999 !important;
            background-color: rgba(0, 0, 0, 0.5) !important;
            opacity: 1 !important;
            visibility: visible !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 16px !important;
        `;
        
        document.body.style.overflow = 'hidden';
        
        // Inicializar funcionalidades do modal
        initializeOrderModal();
        
        // Focar no campo de nome da comanda após o modal ser exibido
        setTimeout(() => {
            const orderNameField = document.getElementById('orderName');
            if (orderNameField) {
                orderNameField.focus();
            }
        }, 100);
        
        console.log('Modal centralizado!');
    }
}
function closeOrderModal() {
    const modal = document.getElementById('orderModal');
    if (modal) {
        // Adicionar classes para esconder
        modal.classList.add('hidden', 'opacity-0');
        
        // Resetar o estilo
        modal.style.display = 'none';
        
        // Restaurar scroll do body
        document.body.style.overflow = '';
        
        // Limpar o formulário
        const form = document.getElementById('orderForm');
        if (form) {
            form.reset();
        }
        
        console.log('Modal fechado!');
    }
}
</script>

<script>
// Focar automaticamente no campo de pesquisa quando a página carregar
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-comandas');
    if (searchInput) {
        // Dar foco no campo
        searchInput.focus();
        
        // Posicionar cursor no final do texto (caso tenha algum valor)
        searchInput.setSelectionRange(searchInput.value.length, searchInput.value.length);
        
        console.log('Foco automático aplicado no campo de pesquisa');
    }
});

// Também focar quando a página ficar visível novamente (quando voltar de outra aba/aplicativo)
document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
        const searchInput = document.getElementById('search-comandas');
        if (searchInput) {
            // Pequeno delay para garantir que a página está totalmente carregada
            setTimeout(() => {
                searchInput.focus();
            }, 100);
        }
    }
});

// Focar novamente quando clicar em qualquer lugar da página (útil para leitores de código)
document.addEventListener('click', function(e) {
    // Não focar se clicou em um input, button ou link
    if (!e.target.matches('input, button, a, select, textarea')) {
        const searchInput = document.getElementById('search-comandas');
        if (searchInput) {
            searchInput.focus();
        }
    }
});
</script>

<!-- DEPOIS vem o JS externo -->
<script src="{% static 'js/home/home.js' %}"></script>

{% endblock %}